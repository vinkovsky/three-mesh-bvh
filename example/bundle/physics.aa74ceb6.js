function e(e){return e&&e.__esModule?e.default:e}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},a={},i=t.parcelRequire4485;null==i&&((i=function(e){if(e in n)return n[e].exports;if(e in a){var t=a[e];delete a[e];var i={id:e,exports:{}};return n[e]=i,t.call(i.exports,i,i.exports),i.exports}var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){a[e]=t},t.parcelRequire4485=i);var o,r,d=i("hGT0Q"),l=i("4EHgc"),s=i("W2bOH"),c=i("7N5zk"),p={};o=p,r=function(){var e=function(){function t(e){return i.appendChild(e.dom),e}function n(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";a=e}var a=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(e){e.preventDefault(),n(++a%i.children.length)}),!1);var o=(performance||Date).now(),r=o,d=0,l=t(new e.Panel("FPS","#0ff","#002")),s=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new e.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:i,addPanel:t,showPanel:n,begin:function(){o=(performance||Date).now()},end:function(){d++;var e=(performance||Date).now();if(s.update(e-o,200),e>r+1e3&&(l.update(1e3*d/(e-r),100),r=e,d=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){o=this.end()},domElement:i,setMode:n}};return e.Panel=function(e,t,n){var a=1/0,i=0,o=Math.round,r=o(window.devicePixelRatio||1),d=80*r,l=48*r,s=3*r,c=2*r,p=3*r,h=15*r,m=74*r,f=30*r,u=document.createElement("canvas");u.width=d,u.height=l,u.style.cssText="width:80px;height:48px";var w=u.getContext("2d");return w.font="bold "+9*r+"px Helvetica,Arial,sans-serif",w.textBaseline="top",w.fillStyle=n,w.fillRect(0,0,d,l),w.fillStyle=t,w.fillText(e,s,c),w.fillRect(p,h,m,f),w.fillStyle=n,w.globalAlpha=.9,w.fillRect(p,h,m,f),{dom:u,update:function(l,y){a=Math.min(a,l),i=Math.max(i,l),w.fillStyle=n,w.globalAlpha=1,w.fillRect(0,0,d,h),w.fillStyle=t,w.fillText(o(l)+" "+e+" ("+o(a)+"-"+o(i)+")",s,c),w.drawImage(u,p+r,h,m-r,f,p,h,m-r,f),w.fillRect(p+m-r,h,r,f),w.fillStyle=n,w.globalAlpha=.9,w.fillRect(p+m-r,h,r,o((1-l/y)*f))}}},e},"object"==typeof p?p=r():"function"==typeof define&&define.amd?define(r):o.Stats=r();var h=i("4Q0VG"),m=i("aBPXg");const f={displayCollider:!1,displayBVH:!1,displayParents:!1,visualizeDepth:10,gravity:-9.8,physicsSteps:5,simulationSpeed:1,sphereSize:1,pause:!1,step:()=>{const e=f.physicsSteps;for(let t=0;t<e;t++)T(.016/e)},explode:function(){const e=new d.Vector3;b.forEach((t=>{e.copy(t.position),e.y+=10,e.normalize(),t.velocity.addScaledVector(e,120)}))},reset:function(){b.forEach((e=>{e.material.dispose(),e.geometry.dispose(),y.remove(e)})),b.length=0,P.forEach((e=>{e.material.dispose(),e.geometry.dispose(),y.remove(e)})),P.length=0}};let u,w,y,S,v,g,M,x,V;const b=[],P=[],z=new d.Sphere,C=new d.Vector3,E=new d.Vector3,B=new d.Vector3(0,0,1);function R(e,t,n,a,i,o=0){if(i<Math.max(Math.abs(.04*f.gravity),5))return;const r=2*Math.max(t?Math.max(e.collider.radius,t.collider.radius):e.collider.radius,.4),l=new d.Mesh(new d.RingBufferGeometry(0,1,30),new d.MeshBasicMaterial({side:2,transparent:!0,depthWrite:!1}));l.lifetime=0,l.maxLifetime=.4,l.maxScale=r*Math.max(Math.sin(Math.min(i/200,1)*Math.PI/2),.35),l.position.copy(n).addScaledVector(a,o),l.quaternion.setFromUnitVectors(B,a),y.add(l),P.push(l)}function H(){const e=new d.Color(16777215),t=new d.Color(1251612).lerp(e,.5*Math.random()+.5).convertSRGBToLinear(),n=new d.Mesh(new d.SphereBufferGeometry(1,20,20),new d.MeshStandardMaterial({color:t}));y.add(n),n.castShadow=!0,n.receiveShadow=!0,n.material.shadowSide=2;const a=.5*f.sphereSize*(.2*Math.random()+.6);return n.scale.setScalar(a),n.collider=new d.Sphere(n.position,a),n.velocity=new d.Vector3(0,0,0),n.mass=Math.pow(a,3)*Math.PI*4/3,b.push(n),n}function L(e){const t=x.geometry.boundsTree;for(let n=0,a=b.length;n<a;n++){const i=b[n],o=i.collider;if(i.velocity.y+=f.gravity*e,o.center.addScaledVector(i.velocity,e),o.center.y<-80){b.splice(n,1),n--,a--,i.material.dispose(),i.geometry.dispose(),y.remove(i);continue}z.copy(i.collider);let r=!1;if(t.shapecast({intersectsBounds:e=>e.intersectsSphere(z),intersectsTriangle:e=>{e.closestPointToPoint(z.center,C),C.sub(z.center);const t=C.length();if(t<z.radius){const e=t-z.radius;C.multiplyScalar(1/t),z.center.addScaledVector(C,e),r=!0}},traverseBoundsOrder:e=>e.distanceToPoint(z.center)-z.radius}),r){C.subVectors(z.center,o.center).normalize(),i.velocity.reflect(C);const t=i.velocity.dot(C);i.velocity.addScaledVector(C,.5*-t),i.velocity.multiplyScalar(Math.max(1-e,0)),o.center.copy(z.center),E.copy(z.center).addScaledVector(C,-z.radius),R(i,null,E,C,t,.05)}}for(let e=0,t=b.length;e<t;e++){const n=b[e],a=n.collider;for(let i=e+1;i<t;i++){const e=b[i],t=e.collider;C.subVectors(a.center,t.center);const o=C.length()-(a.radius+t.radius);if(o<0){C.normalize();const i=n.velocity.dot(C),r=e.velocity.dot(C),l=Math.max(i,.2),s=Math.max(r,.2),c=l+s,p=l/c,h=s/c;a.center.addScaledVector(C,-p*o),t.center.addScaledVector(C,h*o);const m=new d.Vector3;m.addScaledVector(C,-i).addScaledVector(C,r);const f=m.length(),u=n.mass,w=e.mass;let y,S;const v=.5;m.dot(n.velocity)>m.dot(e.velocity)?(y=v*f*(u-w)/(u+w),S=v*f*2*u/(u+w),y-=f):(y=v*f*2*w/(u+w),S=v*f*(w-u)/(u+w),S-=f),m.normalize(),n.velocity.addScaledVector(m,y),e.velocity.addScaledVector(m,S),E.copy(a.center).addScaledVector(C,-a.radius),R(n,e,E,C,f,0)}}n.position.copy(a.center)}}function T(e){if(x){const t=f.physicsSteps;for(let n=0;n<t;n++)L(e/t)}for(let t=0,n=P.length;t<n;t++){const a=P[t];a.lifetime+=e;const i=a.lifetime/a.maxLifetime;let o=Math.sin(4.5*i*Math.PI/4);o=1-Math.pow(1-o,2),a.scale.setScalar(o*a.maxScale),a.material.opacity=1-Math.sin(2*i*Math.PI/4),i>=1&&(P.splice(t,1),a.parent.remove(a),a.geometry.dispose(),a.material.dispose(),t--,n--)}}!function(){const t=1251612;u=new d.WebGLRenderer({antialias:!0}),u.setPixelRatio(window.devicePixelRatio),u.setSize(window.innerWidth,window.innerHeight),u.setClearColor(t,1),u.shadowMap.enabled=!0,u.shadowMap.type=d.PCFSoftShadowMap,u.outputEncoding=d.sRGBEncoding,document.body.appendChild(u.domElement),y=new d.Scene,y.fog=new d.Fog(t,30,70);const n=new d.DirectionalLight(11193599,1);n.position.set(1,1.5,1).multiplyScalar(50),n.intensity=.25;const a=n.shadow.camera;a.bottom=a.left=-10,a.top=a.right=10,y.add(n),y.add(new d.HemisphereLight(4491519,2241348,.3)),w=new d.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,50),w.position.set(10,10,-10),w.far=100,w.updateProjectionMatrix(),window.camera=w,S=new d.Clock,new s.OrbitControls(w,u.domElement),g=new(e(p)),document.body.appendChild(g.dom),(new l.GLTFLoader).load("../models/low_poly_environment_jungle_scene/scene.gltf",(e=>{M=e.scene,M.scale.setScalar(.05);const t=new d.PointLight(65535);t.distance=7,t.position.set(-100,-40,100),M.add(t);const n=new d.PointLight(16768358);n.distance=15,n.intensity=5,n.position.set(80,80,135),n.shadow.normalBias=.01,n.shadow.bias=-.001,n.shadow.mapSize.setScalar(1024),n.castShadow=!0,M.add(n);const a=[];M.updateMatrixWorld(!0),M.traverse((e=>{if(e.geometry){const t=e.geometry.clone();t.applyMatrix4(e.matrixWorld);for(const e in t.attributes)"position"!==e&&t.deleteAttribute(e);a.push(t)}}));const i=c.mergeBufferGeometries(a,!1);i.boundsTree=new m.MeshBVH(i),x=new d.Mesh(i),x.material.wireframe=!0,x.material.opacity=.5,x.material.transparent=!0,V=new m.MeshBVHVisualizer(x,f.visualizeDepth),y.add(V),y.add(x),y.add(M),M.traverse((e=>{e.material&&(e.castShadow=!0,e.receiveShadow=!0,e.material.shadowSide=2)}))})),v=new h.GUI;const i=v.addFolder("Visualization");i.add(f,"displayCollider"),i.add(f,"displayBVH"),i.add(f,"displayParents").onChange((e=>{V.displayParents=e,V.update()})),i.add(f,"visualizeDepth",1,20,1).onChange((e=>{V.depth=e,V.update()})),i.open();const o=v.addFolder("Physics");o.add(f,"physicsSteps",0,30,1),o.add(f,"gravity",-100,100,.01).onChange((e=>{f.gravity=parseFloat(e)})),o.add(f,"simulationSpeed",0,5,.01),o.add(f,"sphereSize",.2,5,.1),o.add(f,"pause"),o.add(f,"step"),o.open(),v.add(f,"explode"),v.add(f,"reset"),v.open();const r=new d.Raycaster,b=new d.Vector2;let P=0,z=0;u.domElement.addEventListener("pointerdown",(e=>{P=e.clientX,z=e.clientY})),u.domElement.addEventListener("pointerup",(e=>{if(Math.abs(e.clientX-P)+Math.abs(e.clientY-z)>2)return;b.x=e.clientX/window.innerWidth*2-1,b.y=-e.clientY/window.innerHeight*2+1,r.setFromCamera(b,w);const t=H();t.position.copy(w.position).addScaledVector(r.ray.direction,3),t.velocity.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).addScaledVector(r.ray.direction,10*Math.random()+15).multiplyScalar(.5)})),window.addEventListener("resize",(function(){w.aspect=window.innerWidth/window.innerHeight,w.updateProjectionMatrix(),u.setSize(window.innerWidth,window.innerHeight)}),!1),window.createSphere=H}(),function e(){g.update(),requestAnimationFrame(e);const t=Math.min(S.getDelta(),.1);x&&(x.visible=f.displayCollider,V.visible=f.displayBVH,f.pause||T(f.simulationSpeed*t));u.render(y,w)}();
//# sourceMappingURL=physics.aa74ceb6.js.map
