{"mappings":"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","sources":["node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js","node_modules/@parcel/runtime-js/lib/runtime-8505b42dff4e8b60.js","src/workers/GenerateMeshBVHWorker.js","node_modules/@parcel/runtime-js/lib/runtime-7dcb2fe6f3ae45ea.js","node_modules/@parcel/runtime-js/lib/helpers/get-worker-url.js","node_modules/@parcel/runtime-js/lib/helpers/bundle-url.js"],"sourcesContent":["\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","require('./helpers/bundle-manifest').register(JSON.parse(\"{\\\"ev3hb\\\":\\\"asyncGenerate.6fa40a09.js\\\",\\\"8LgXY\\\":\\\"generateAsync.worker.f030fc94.js\\\"}\"));","import { Box3, BufferAttribute } from 'three';\nimport { MeshBVH } from '../core/MeshBVH.js';\n\nexport class GenerateMeshBVHWorker {\n\n\tconstructor() {\n\n\t\tthis.running = false;\n\t\tthis.worker = new Worker( new URL( './generateAsync.worker.js', import.meta.url ), { type: 'module' } );\n\n\t}\n\n\tgenerate( geometry, options = {} ) {\n\n\t\tif ( this.running ) {\n\n\t\t\tthrow new Error( 'GenerateMeshBVHWorker: Already running job.' );\n\n\t\t}\n\n\t\tconst { worker } = this;\n\t\tthis.running = true;\n\n\t\treturn new Promise( ( resolve, reject ) => {\n\n\t\t\tworker.onmessage = e => {\n\n\t\t\t\tthis.running = false;\n\t\t\t\tconst { data } = e;\n\n\t\t\t\tif ( data.error ) {\n\n\t\t\t\t\treject( new Error( data.error ) );\n\t\t\t\t\tworker.onmessage = null;\n\n\t\t\t\t} else if ( data.serialized ) {\n\n\t\t\t\t\tconst { serialized, position } = data;\n\t\t\t\t\tconst bvh = MeshBVH.deserialize( serialized, geometry, { setIndex: false } );\n\t\t\t\t\tconst boundsOptions = Object.assign( {\n\n\t\t\t\t\t\tsetBoundingBox: true,\n\n\t\t\t\t\t}, options );\n\n\t\t\t\t\t// we need to replace the arrays because they're neutered entirely by the\n\t\t\t\t\t// webworker transfer.\n\t\t\t\t\tgeometry.attributes.position.array = position;\n\t\t\t\t\tif ( geometry.index ) {\n\n\t\t\t\t\t\tgeometry.index.array = serialized.index;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconst newIndex = new BufferAttribute( serialized.index, 1, false );\n\t\t\t\t\t\tgeometry.setIndex( newIndex );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( boundsOptions.setBoundingBox ) {\n\n\t\t\t\t\t\tgeometry.boundingBox = bvh.getBoundingBox( new Box3() );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve( bvh );\n\t\t\t\t\tworker.onmessage = null;\n\n\t\t\t\t} else if ( options.onProgress ) {\n\n\t\t\t\t\toptions.onProgress( data.progress );\n\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t\tconst index = geometry.index ? geometry.index.array : null;\n\t\t\tconst position = geometry.attributes.position.array;\n\n\t\t\tif ( position.isInterleavedBufferAttribute || index && index.isInterleavedBufferAttribute ) {\n\n\t\t\t\tthrow new Error( 'GenerateMeshBVHWorker: InterleavedBufferAttribute are not supported for the geometry attributes.' );\n\n\t\t\t}\n\n\t\t\tconst transferrables = [ position ];\n\t\t\tif ( index ) {\n\n\t\t\t\ttransferrables.push( index );\n\n\t\t\t}\n\n\t\t\tworker.postMessage( {\n\n\t\t\t\tindex,\n\t\t\t\tposition,\n\t\t\t\toptions: {\n\t\t\t\t\t...options,\n\t\t\t\t\tonProgress: null,\n\t\t\t\t\tincludedProgressCallback: Boolean( options.onProgress ),\n\t\t\t\t},\n\n\t\t\t}, transferrables.map( arr => arr.buffer ) );\n\n\t\t} );\n\n\t}\n\n\tterminate() {\n\n\t\tthis.worker.terminate();\n\n\t}\n\n}\n","let workerURL = require('./helpers/get-worker-url');\nlet bundleURL = require('./helpers/bundle-url');\nlet url = bundleURL.getBundleURL('ev3hb') + require('./helpers/bundle-manifest').resolve(\"8LgXY\");module.exports = workerURL(url, bundleURL.getOrigin(url), true);","\"use strict\";\n\nmodule.exports = function (workerUrl, origin, isESM) {\n  if (origin === self.location.origin) {\n    // If the worker bundle's url is on the same origin as the document,\n    // use the worker bundle's own url.\n    return workerUrl;\n  } else {\n    // Otherwise, create a blob URL which loads the worker bundle with `importScripts`.\n    var source = isESM ? 'import ' + JSON.stringify(workerUrl) + ';' : 'importScripts(' + JSON.stringify(workerUrl) + ');';\n    return URL.createObjectURL(new Blob([source], {\n      type: 'application/javascript'\n    }));\n  }\n};","\"use strict\";\n\nvar bundleURL = {};\n\nfunction getBundleURLCached(id) {\n  var value = bundleURL[id];\n\n  if (!value) {\n    value = getBundleURL();\n    bundleURL[id] = value;\n  }\n\n  return value;\n}\n\nfunction getBundleURL() {\n  try {\n    throw new Error();\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp):\\/\\/[^)\\n]+/g);\n\n    if (matches) {\n      // The first two stack frames will be this function and getBundleURLCached.\n      // Use the 3rd one, which will be a runtime in the original bundle.\n      return getBaseURL(matches[2]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n} // TODO: Replace uses with `new URL(url).origin` when ie11 is no longer supported.\n\n\nfunction getOrigin(url) {\n  var matches = ('' + url).match(/(https?|file|ftp):\\/\\/[^/]+/);\n\n  if (!matches) {\n    throw new Error('Origin not found');\n  }\n\n  return matches[0];\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\nexports.getOrigin = getOrigin;"],"names":["$8b4d1930797b255e$export$6503ec6e8aabbaf","$8b4d1930797b255e$export$f7ad0328861e2f03","$8b4d1930797b255e$var$mapping","pairs","keys","Object","i","length","id","resolved","Error","parcelRequire","register","JSON","parse","$2a15da384e51c9e3$export$426cc6213ad628cf","this","running","worker","Worker","type","generate","geometry","options","Promise","resolve","reject","onmessage","e","data","error","serialized","position","bvh","$7xeSy","MeshBVH","deserialize","setIndex","boundsOptions","assign","setBoundingBox","attributes","array","index","newIndex","$hGT0Q","BufferAttribute","boundingBox","getBoundingBox","Box3","onProgress","progress","isInterleavedBufferAttribute","transferrables","push","postMessage","includedProgressCallback","Boolean","map","arr","buffer","terminate","$bffa954d254f76bf$var$url","$kPq84","getBundleURL","module","exports","$hxJhJ","getOrigin","workerUrl","origin","isESM","self","location","source","stringify","URL","createObjectURL","Blob","$f29cd6c67ea13581$export$bdfd709ae4826697","$f29cd6c67ea13581$export$5a759dc7a1cfb72a","$f29cd6c67ea13581$var$bundleURL","$f29cd6c67ea13581$var$getBaseURL","url","replace","value","err","matches","stack","match","$f29cd6c67ea13581$var$getBundleURL"],"version":3,"file":"asyncGenerate.6fa40a09.js.map"}