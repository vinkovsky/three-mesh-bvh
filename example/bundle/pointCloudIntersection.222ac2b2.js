var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},n={},r=e.parcelRequire4485;null==r&&((r=function(e){if(e in t)return t[e].exports;if(e in n){var r=n[e];delete n[e];var o={id:e,exports:{}};return t[e]=o,r.call(o.exports,o,o.exports),o.exports}var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){n[e]=t},e.parcelRequire4485=r);var o=function(){var e=0,t=document.createElement("div");function n(e){return t.appendChild(e.dom),e}function r(n){for(var r=0;r<t.children.length;r++)t.children[r].style.display=r===n?"block":"none";e=n}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(n){n.preventDefault(),r(++e%t.children.length)}),!1);var i=(performance||Date).now(),s=i,a=0,l=n(new o.Panel("FPS","#0ff","#002")),c=n(new o.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var d=n(new o.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:t,addPanel:n,showPanel:r,begin:function(){i=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(c.update(e-i,200),e>s+1e3&&(l.update(1e3*a/(e-s),100),s=e,a=0,d)){var t=performance.memory;d.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:t,setMode:r}};o.Panel=function(e,t,n){var r=1/0,o=0,i=Math.round,s=i(window.devicePixelRatio||1),a=80*s,l=48*s,c=3*s,d=2*s,p=3*s,u=15*s,f=74*s,h=30*s,m=document.createElement("canvas");m.width=a,m.height=l,m.style.cssText="width:80px;height:48px";var y=m.getContext("2d");return y.font="bold "+9*s+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=n,y.fillRect(0,0,a,l),y.fillStyle=t,y.fillText(e,c,d),y.fillRect(p,u,f,h),y.fillStyle=n,y.globalAlpha=.9,y.fillRect(p,u,f,h),{dom:m,update:function(l,w){r=Math.min(r,l),o=Math.max(o,l),y.fillStyle=n,y.globalAlpha=1,y.fillRect(0,0,a,u),y.fillStyle=t,y.fillText(i(l)+" "+e+" ("+i(r)+"-"+i(o)+")",c,d),y.drawImage(m,p+s,u,f-s,h,p,u,f-s,h),y.fillRect(p+f-s,u,s,h),y.fillStyle=n,y.globalAlpha=.9,y.fillRect(p+f-s,u,s,i((1-l/w)*h))}}};var i=r("hGT0Q"),s=r("W2bOH");i=r("hGT0Q");class a extends i.Loader{constructor(e){super(e),this.propertyNameMapping={}}load(e,t,n,r){const o=this,s=new i.FileLoader(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{t(o.parse(n))}catch(t){r?r(t):console.error(t),o.manager.itemError(e)}}),n,r)}setPropertyNameMapping(e){this.propertyNameMapping=e}parse(e){function t(e){let t="",n=0;const r=/ply([\s\S]*)end_header\r?\n/.exec(e);null!==r&&(t=r[1],n=new Blob([r[0]]).size);const o={comments:[],elements:[],headerLength:n,objInfo:""},i=t.split("\n");let s;function a(e,t){const n={type:e[0]};return"list"===n.type?(n.name=e[3],n.countType=e[1],n.itemType=e[2]):n.name=e[1],n.name in t&&(n.name=t[n.name]),n}for(let e=0;e<i.length;e++){let t=i[e];if(t=t.trim(),""===t)continue;const n=t.split(/\s+/),r=n.shift();switch(t=n.join(" "),r){case"format":o.format=n[0],o.version=n[1];break;case"comment":o.comments.push(t);break;case"element":void 0!==s&&o.elements.push(s),s={},s.name=n[0],s.count=parseInt(n[1]),s.properties=[];break;case"property":s.properties.push(a(n,p.propertyNameMapping));break;case"obj_info":o.objInfo=t;break;default:console.log("unhandled",r,n)}}return void 0!==s&&o.elements.push(s),o}function n(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function r(e,t){const r=t.split(/\s+/),o={};for(let t=0;t<e.length;t++)if("list"===e[t].type){const i=[],s=n(r.shift(),e[t].countType);for(let o=0;o<s;o++)i.push(n(r.shift(),e[t].itemType));o[e[t].name]=i}else o[e[t].name]=n(r.shift(),e[t].type);return o}function o(e,t){const n={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]};let o;let i="";null!==(o=/end_header\s([\s\S]*)$/.exec(e))&&(i=o[1]);const l=i.split("\n");let c=0,d=0;for(let e=0;e<l.length;e++){let o=l[e];if(o=o.trim(),""===o)continue;d>=t.elements[c].count&&(c++,d=0);const i=r(t.elements[c].properties,o);a(n,t.elements[c].name,i),d++}return s(n)}function s(e){let t=new i.BufferGeometry;return e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new i.Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new i.Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new i.Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new i.Float32BufferAttribute(e.colors,3)),e.faceVertexUvs.length>0&&(t=t.toNonIndexed(),t.setAttribute("uv",new i.Float32BufferAttribute(e.faceVertexUvs,2))),t.computeBoundingSphere(),t}function a(e,t,n){if("vertex"===t)e.vertices.push(n.x,n.y,n.z),"nx"in n&&"ny"in n&&"nz"in n&&e.normals.push(n.nx,n.ny,n.nz),"s"in n&&"t"in n&&e.uvs.push(n.s,n.t),"red"in n&&"green"in n&&"blue"in n&&e.colors.push(n.red/255,n.green/255,n.blue/255);else if("face"===t){const t=n.vertex_indices||n.vertex_index,r=n.texcoord;3===t.length?(e.indices.push(t[0],t[1],t[2]),r&&6===r.length&&(e.faceVertexUvs.push(r[0],r[1]),e.faceVertexUvs.push(r[2],r[3]),e.faceVertexUvs.push(r[4],r[5]))):4===t.length&&(e.indices.push(t[0],t[1],t[3]),e.indices.push(t[1],t[2],t[3]))}}function l(e,t,n,r){switch(n){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,r),2];case"uint16":case"ushort":return[e.getUint16(t,r),2];case"int32":case"int":return[e.getInt32(t,r),4];case"uint32":case"uint":return[e.getUint32(t,r),4];case"float32":case"float":return[e.getFloat32(t,r),4];case"float64":case"double":return[e.getFloat64(t,r),8]}}function c(e,t,n,r){const o={};let i,s=0;for(let a=0;a<n.length;a++)if("list"===n[a].type){const c=[];i=l(e,t+s,n[a].countType,r);const d=i[0];s+=i[1];for(let o=0;o<d;o++)i=l(e,t+s,n[a].itemType,r),c.push(i[0]),s+=i[1];o[n[a].name]=c}else i=l(e,t+s,n[a].type,r),o[n[a].name]=i[0],s+=i[1];return[o,s]}let d;const p=this;if(e instanceof ArrayBuffer){const n=i.LoaderUtils.decodeText(new Uint8Array(e)),r=t(n);d="ascii"===r.format?o(n,r):function(e,t){const n={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},r="binary_little_endian"===t.format,o=new DataView(e,t.headerLength);let i,l=0;for(let e=0;e<t.elements.length;e++)for(let s=0;s<t.elements[e].count;s++){i=c(o,l,t.elements[e].properties,r),l+=i[1];const s=i[0];a(n,t.elements[e].name,s)}return s(n)}(e,r)}else d=o(e,t(e));return d}}var l=r("4Q0VG"),c=r("aBPXg");let d,p,u,f,h,m,y,w;i.Mesh.prototype.raycast=c.acceleratedRaycast,i.BufferGeometry.prototype.computeBoundsTree=c.computeBoundsTree,i.BufferGeometry.prototype.disposeBoundsTree=c.disposeBoundsTree;let g,v=new i.Vector2;const x=new i.Raycaster,b={displayHelper:!1,helperDepth:10,displayParents:!1,strategy:c.CENTER,pointSize:.005,raycastThreshold:.005,useBVH:!0};window.addEventListener("pointermove",(e=>{if(!h)return;v.x=e.clientX/window.innerWidth*2-1,v.y=-e.clientY/window.innerHeight*2+1,x.setFromCamera(v,u);const t=window.performance.now();if(b.useBVH){g.visible=!1;const e=new i.Matrix4;e.copy(h.matrixWorld).invert(),x.ray.applyMatrix4(e);const t=x.params.Points.threshold/((h.scale.x+h.scale.y+h.scale.z)/3),n=t*t,{ray:r}=x;let o=1/0;h.geometry.boundsTree.shapecast({boundsTraverseOrder:e=>e.distanceToPoint(r.origin),intersectsBounds:(e,n,i)=>i>o?c.NOT_INTERSECTED:(e.expandByScalar(t),r.intersectsBox(e)?c.INTERSECTED:c.NOT_INTERSECTED),intersectsTriangle:e=>{if(r.distanceSqToPoint(e.a)<n){const t=r.origin.distanceTo(e.a);t<o&&(o=t,g.position.copy(e.a).applyMatrix4(h.matrixWorld),g.visible=!0)}}})}else{const e=x.intersectObject(y,!0)[0];e?(g.position.copy(e.point),g.visible=!0):g.visible=!1}const n=window.performance.now()-t;w.innerText=`${n.toFixed(2)}ms`}),!1),function(){w=document.getElementById("output"),f=new i.WebGLRenderer({antialias:!0}),f.setPixelRatio(window.devicePixelRatio),f.setSize(window.innerWidth,window.innerHeight),f.setClearColor(1251612,1),document.body.appendChild(f.domElement),p=new i.Scene,u=new i.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,50),u.position.set(3,3,3),u.far=100,u.updateProjectionMatrix(),new s.OrbitControls(u,f.domElement),d=new o,document.body.appendChild(d.dom),window.addEventListener("resize",(function(){u.aspect=window.innerWidth/window.innerHeight,u.updateProjectionMatrix(),f.setSize(window.innerWidth,window.innerHeight)}),!1),(new a).load("../models/point_cloud_porsche_911_1.7M_vertices/scene.ply",(e=>{e.center();const t=new i.PointsMaterial({size:b.pointSize,vertexColors:!0});y=new i.Points(e,t),y.matrixAutoUpdate=!1,p.add(y);const n=[],r=e.clone();for(let e=0,t=r.attributes.position.count;e<t;e++)n.push(e,e,e);r.setIndex(n);const o=new i.MeshBasicMaterial({color:16711680});h=new i.Mesh(r,o),console.time("computeBoundsTree"),h.geometry.computeBoundsTree({mode:b.mode}),console.timeEnd("computeBoundsTree"),m=new c.MeshBVHVisualizer(h,b.depth),p.add(m)}));const e=new i.SphereGeometry(.01,32,32),t=new i.MeshBasicMaterial({color:16776960,opacity:.9,transparent:!0});g=new i.Mesh(e,t),g.visible=!1,p.add(g);const n=new l.GUI,r=n.addFolder("helper");r.add(b,"displayHelper"),r.add(b,"displayParents").onChange((e=>{m.displayParents=e,m.update()})),r.add(b,"helperDepth",1,20,1).name("depth").onChange((e=>{m.depth=parseInt(e),m.update()})),r.open();const v=n.addFolder("points");v.add(b,"useBVH"),v.add(b,"strategy",{CENTER:c.CENTER,AVERAGE:c.AVERAGE,SAH:c.SAH}).onChange((e=>{console.time("computeBoundsTree"),h.geometry.computeBoundsTree({strategy:parseInt(e)}),console.timeEnd("computeBoundsTree"),m.update()})),v.add(b,"pointSize",.001,.01,.001),v.add(b,"raycastThreshold",.001,.01,.001),v.open()}(),function e(){requestAnimationFrame(e),y&&(y.material.size=b.pointSize,m.visible=b.displayHelper,x.params.Points.threshold=b.raycastThreshold),d.begin(),f.render(p,u),d.end()}();
//# sourceMappingURL=pointCloudIntersection.222ac2b2.js.map
