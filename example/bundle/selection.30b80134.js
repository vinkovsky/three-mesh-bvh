function e(e){return e&&e.__esModule?e.default:e}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},o={},r=t.parcelRequire4485;null==r&&((r=function(e){if(e in n)return n[e].exports;if(e in o){var t=o[e];delete o[e];var r={id:e,exports:{}};return n[e]=r,t.call(r.exports,r,r.exports),r.exports}var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){o[e]=t},t.parcelRequire4485=r);var i,l,a=r("hGT0Q"),d={};i=d,l=function(){var e=function(){function t(e){return r.appendChild(e.dom),e}function n(e){for(var t=0;t<r.children.length;t++)r.children[t].style.display=t===e?"block":"none";o=e}var o=0,r=document.createElement("div");r.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",(function(e){e.preventDefault(),n(++o%r.children.length)}),!1);var i=(performance||Date).now(),l=i,a=0,d=t(new e.Panel("FPS","#0ff","#002")),s=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new e.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:r,addPanel:t,showPanel:n,begin:function(){i=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(s.update(e-i,200),e>l+1e3&&(d.update(1e3*a/(e-l),100),l=e,a=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:r,setMode:n}};return e.Panel=function(e,t,n){var o=1/0,r=0,i=Math.round,l=i(window.devicePixelRatio||1),a=80*l,d=48*l,s=3*l,c=2*l,f=3*l,u=15*l,p=74*l,h=30*l,w=document.createElement("canvas");w.width=a,w.height=d,w.style.cssText="width:80px;height:48px";var y=w.getContext("2d");return y.font="bold "+9*l+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=n,y.fillRect(0,0,a,d),y.fillStyle=t,y.fillText(e,s,c),y.fillRect(f,u,p,h),y.fillStyle=n,y.globalAlpha=.9,y.fillRect(f,u,p,h),{dom:w,update:function(d,m){o=Math.min(o,d),r=Math.max(r,d),y.fillStyle=n,y.globalAlpha=1,y.fillRect(0,0,a,u),y.fillStyle=t,y.fillText(i(d)+" "+e+" ("+i(o)+"-"+i(r)+")",s,c),y.drawImage(w,f+l,u,p-l,h,f,u,p-l,h),y.fillRect(f+p-l,u,l,h),y.fillStyle=n,y.globalAlpha=.9,y.fillRect(f+p-l,u,l,i((1-d/m)*h))}}},e},"object"==typeof d?d=l():"function"==typeof define&&define.amd?define(l):i.Stats=l();var s=r("4Q0VG"),c=r("W2bOH"),f=r("aBPXg");const u={toolMode:"lasso",selectionMode:"intersection",liveUpdate:!1,selectModel:!1,wireframe:!1,useBoundsTree:!0,displayHelper:!1,helperDepth:10,rotate:!0};let p,h,w,y,m,g,x,M,E,T,v,b,S;const R=[];let B=!1,O=!1,A=!1;!function(){b=document.getElementById("output");const t=new a.Color(2503224);p=new a.WebGLRenderer({antialias:!0}),p.setPixelRatio(window.devicePixelRatio),p.setSize(window.innerWidth,window.innerHeight),p.setClearColor(t,1),p.shadowMap.enabled=!0,p.outputEncoding=a.sRGBEncoding,document.body.appendChild(p.domElement),w=new a.Scene;const n=new a.DirectionalLight(16777215,1);n.castShadow=!0,n.shadow.mapSize.set(2048,2048),n.position.set(10,10,10),w.add(n),w.add(new a.AmbientLight(11583173,.8)),h=new a.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,50),h.position.set(2,4,6),h.far=100,h.updateProjectionMatrix(),w.add(h),x=new a.Line,x.material.color.set(16750592).convertSRGBToLinear(),x.renderOrder=1,x.position.z=-.2,x.depthTest=!1,x.scale.setScalar(1),h.add(x),S=new a.Group,w.add(S),M=new a.Mesh(new a.TorusKnotBufferGeometry(1.5,.5,500,60).toNonIndexed(),new a.MeshStandardMaterial({polygonOffset:!0,polygonOffsetFactor:1})),M.geometry.boundsTree=new f.MeshBVH(M.geometry),M.geometry.setAttribute("color",new a.Uint8BufferAttribute(new Array(3*M.geometry.index.count).fill(255),3,!0)),M.castShadow=!0,M.receiveShadow=!0,S.add(M),E=new f.MeshBVHVisualizer(M,10),S.add(E),T=new a.Mesh,T.geometry=M.geometry.clone(),T.geometry.drawRange.count=0,T.material=new a.MeshBasicMaterial({opacity:.05,transparent:!0,depthWrite:!1}),T.material.color.set(16750592).convertSRGBToLinear(),T.renderOrder=1,S.add(T),v=new a.Mesh,v.geometry=T.geometry,v.material=new a.MeshBasicMaterial({opacity:.25,transparent:!0,wireframe:!0,depthWrite:!1}),v.material.color.copy(T.material.color),v.renderOrder=2,S.add(v);const o=new a.GridHelper(10,10,16777215,16777215);o.material.opacity=.2,o.material.transparent=!0,o.position.y=-2.75,w.add(o);const r=new a.Mesh(new a.PlaneBufferGeometry,new a.ShadowMaterial({color:0,opacity:.2,depthWrite:!1}));r.position.y=-2.74,r.rotation.x=-Math.PI/2,r.scale.setScalar(20),r.renderOrder=2,r.receiveShadow=!0,w.add(r),m=new(e(d)),document.body.appendChild(m.dom),g=new c.OrbitControls(h,p.domElement),g.minDistance=3,g.touches.ONE=a.TOUCH.PAN,g.mouseButtons.LEFT=a.MOUSE.PAN,g.touches.TWO=a.TOUCH.ROTATE,g.mouseButtons.RIGHT=a.MOUSE.ROTATE,g.enablePan=!1,y=new s.GUI;const i=y.addFolder("selection");i.add(u,"toolMode",["lasso","box"]),i.add(u,"selectionMode",["centroid","intersection"]),i.add(u,"selectModel"),i.add(u,"liveUpdate"),i.add(u,"useBoundsTree"),i.open();const l=y.addFolder("display");l.add(u,"wireframe"),l.add(u,"rotate"),l.add(u,"displayHelper"),l.add(u,"helperDepth",1,30,1).onChange((e=>{E.depth=e,E.update()})),l.open(),y.open();let C=-1/0,D=-1/0,H=-1/0,P=-1/0;const N=new a.Vector2,I=new a.Vector2,L=new a.Vector2;p.domElement.addEventListener("pointerdown",(e=>{H=e.clientX,P=e.clientY,C=e.clientX/window.innerWidth*2-1,D=-(e.clientY/window.innerHeight*2-1),R.length=0,B=!0})),p.domElement.addEventListener("pointerup",(()=>{x.visible=!1,B=!1,R.length&&(A=!0)})),p.domElement.addEventListener("pointermove",(e=>{if(0==(1&e.buttons))return;const t=e.clientX,n=e.clientY,o=e.clientX/window.innerWidth*2-1,r=-(e.clientY/window.innerHeight*2-1);if("box"===u.toolMode)R.length=15,R[0]=C,R[1]=D,R[2]=0,R[3]=o,R[4]=D,R[5]=0,R[6]=o,R[7]=r,R[8]=0,R[9]=C,R[10]=r,R[11]=0,R[12]=C,R[13]=D,R[14]=0,t===H&&n===P||(O=!0),H=t,P=n,x.visible=!0,u.liveUpdate&&(A=!0);else if(Math.abs(t-H)>=3||Math.abs(n-P)>=3){const e=3*(R.length/3-1);let i=!1;if(R.length>3){N.set(R[e-3],R[e-3+1]),I.set(R[e],R[e+1]),I.sub(N).normalize(),N.set(R[e],R[e+1]),L.set(o,r),L.sub(N).normalize();i=I.dot(L)>.99}i?(R[e]=o,R[e+1]=r):R.push(o,r,0),O=!0,x.visible=!0,H=t,P=n,u.liveUpdate&&(A=!0)}})),window.addEventListener("resize",(function(){h.aspect=window.innerWidth/window.innerHeight,h.updateProjectionMatrix(),p.setSize(window.innerWidth,window.innerHeight)}),!1)}(),function e(){if(m.update(),requestAnimationFrame(e),M.material.wireframe=u.wireframe,E.visible=u.displayHelper,O){if("lasso"===u.toolMode){const e=R.length;R.push(R[0],R[1],R[2]),x.geometry.setAttribute("position",new a.Float32BufferAttribute(R,3,!1)),R.length=e}else x.geometry.setAttribute("position",new a.Float32BufferAttribute(R,3,!1));x.frustumCulled=!1,O=!1}A&&(A=!1,R.length>0&&function(){C.copy(M.matrixWorld).premultiply(h.matrixWorldInverse).premultiply(h.projectionMatrix);for(;P.length<R.length;)P.push(new a.Line3);P.length=R.length;for(let e=0,t=R.length;e<t;e+=3){const n=P[e],o=(e+3)%t;n.start.x=R[e],n.start.y=R[e+1],n.end.x=R[o],n.end.y=R[o+1]}const e=window.performance.now(),t=[];M.geometry.boundsTree.shapecast({intersectsBounds:(e,t,n,o)=>{if(!u.useBoundsTree)return f.INTERSECTED;const{min:r,max:i}=e;let l=0,a=1/0,d=-1/0,s=1/0;for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let n=0;n<=1;n++){const o=D[l];o.x=0===e?r.x:i.x,o.y=0===t?r.y:i.y,o.z=0===n?r.z:i.z,o.w=1,o.applyMatrix4(C),l++,o.y<a&&(a=o.y),o.y>d&&(d=o.y),o.x<s&&(s=o.x)}const c=N[o-1]||P,p=N[o]||[];p.length=0,N[o]=p;for(let e=0,t=c.length;e<t;e++){const t=c[e],n=t.start.x,o=t.start.y,r=t.end.x,i=t.end.y;if(n<s&&r<s)continue;const l=i>d;if(o>d&&l)continue;const f=i<a;o<a&&f||p.push(t)}if(0===p.length)return f.NOT_INTERSECTED;const h=function(e){function t(e,t,n){const o=(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y);return 0==o?0:o>0?1:2}function n(e,t){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)}function o(e,o){const r=t(l,e,o);return 0==r?n(l,o)>=n(l,e)?-1:1:2==r?-1:1}let r=1/0,i=-1;for(let t=0,n=e.length;t<n;t++){const n=e[t];n.y<r&&(i=t,r=n.y)}const l=e[i];e[i]=e[0],e[0]=l,e=e.sort(o);let a=1;const d=e.length;for(let n=1;n<d;n++){for(;n<d-1&&0==t(l,e[n],e[n+1]);)n++;e[a]=e[n],a++}if(a<3)return null;const s=[e[0],e[1],e[2]];for(let n=3;n<a;n++){for(;2!==t(s[s.length-2],s[s.length-1],e[n]);)s.pop();s.push(e[n])}return s}(D),w=h.map(((e,t)=>{const n=h[(t+1)%h.length],o=H[t];return o.start.copy(e),o.end.copy(n),o}));if(L(p[0].start,w)%2==1)return f.INTERSECTED;let y=0;for(let e=0,t=h.length;e<t;e++){const t=L(h[e],p);if(0===e&&(y=t),y!==t)return f.INTERSECTED}for(let e=0,t=w.length;e<t;e++){const t=w[e];for(let e=0,n=p.length;e<n;e++)if(U(t,p[e]))return f.INTERSECTED}return y%2==0?f.NOT_INTERSECTED:f.CONTAINED},intersectsTriangle:(e,n,o,r)=>{const i=3*n,l=i+0,a=i+1,d=i+2;if(o)return t.push(l,a,d),u.selectModel;const s=u.useBoundsTree?N[r]:P;if("centroid"===u.selectionMode){const n=e.a.add(e.b).add(e.c).multiplyScalar(1/3);n.applyMatrix4(C);if(L(n,s)%2==1)return t.push(l,a,d),u.selectModel}else if("intersection"===u.selectionMode){const n=[e.a,e.b,e.c];for(let e=0;e<3;e++){const o=n[e];o.applyMatrix4(C);if(L(o,s)%2==1)return t.push(l,a,d),u.selectModel}const o=[H[0],H[1],H[2]];o[0].start.copy(e.a),o[0].end.copy(e.b),o[1].start.copy(e.b),o[1].end.copy(e.c),o[2].start.copy(e.c),o[2].end.copy(e.a);for(let e=0;e<3;e++){const n=o[e];for(let e=0,o=s.length;e<o;e++)if(U(n,s[e]))return t.push(l,a,d),u.selectModel}}return!1}});const n=window.performance.now()-e;b.innerText=`${n.toFixed(3)}ms`;const o=M.geometry.index,r=T.geometry.index;if(t.length&&u.selectModel){for(let e=0,t=o.count;e<t;e++){const t=o.getX(e);r.setX(e,t)}T.geometry.drawRange.count=1/0,r.needsUpdate=!0}else{for(let e=0,n=t.length;e<n;e++){const n=o.getX(t[e]);r.setX(e,n)}T.geometry.drawRange.count=t.length,r.needsUpdate=!0}}());const t=Math.tan(a.MathUtils.DEG2RAD*h.fov/2)*x.position.z;x.scale.set(-t*h.aspect,-t,1),p.render(w,h),u.rotate&&(S.rotation.y+=.01,u.liveUpdate&&B&&(A=!0))}();const C=new a.Matrix4,D=new Array(8).fill().map((()=>new a.Vector3)),H=new Array(12).fill().map((()=>new a.Line3)),P=[],N=[];function I(e,t,n,o){const{start:r,end:i}=t,l=e.x,a=e.y,d=r.y,s=i.y;if(d===s)return!1;if(a>d&&a>s)return!1;if(a<d&&a<s)return!1;const c=r.x,f=i.x;if(l>c&&l>f)return!1;if(l<c&&l<f)return a!==d||n===o;const u=s-d,p=u*(l-c)+-(f-c)*(a-d);return Math.sign(p)!==Math.sign(u)}function L(e,t){let n=0;const o=t[t.length-1];let r=o.start.y>o.end.y;for(let o=0,i=t.length;o<i;o++){const i=t[o],l=i.start.y>i.end.y;I(e,i,r,l)&&n++,r=l}return n}function U(e,t){function n(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}const o=e.start,r=e.end,i=t.start,l=t.end;return n(o,i,l)!==n(r,i,l)&&n(o,r,i)!==n(o,r,l)}
//# sourceMappingURL=selection.30b80134.js.map
